<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .error { color: red; margin-top: 10px; }
        .success { color: green; margin-top: 10px; }
        .debug { background: #f8f9fa; padding: 10px; border-radius: 4px; margin-top: 10px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Appointment Debug Test</h1>
        <p>This form will test the appointment creation API directly.</p>
        
        <form id="appointmentForm">
            <div class="form-group">
                <label for="doctorId">Doctor ID:</label>
                <input type="number" id="doctorId" value="1" required>
            </div>
            
            <div class="form-group">
                <label for="hospitalId">Hospital ID:</label>
                <input type="number" id="hospitalId" value="1" required>
            </div>
            
            <div class="form-group">
                <label for="serviceCategoryId">Service Category ID:</label>
                <input type="number" id="serviceCategoryId" value="1" required>
            </div>
            
            <div class="form-group">
                <label for="appointmentDateTime">Appointment Date & Time:</label>
                <input type="datetime-local" id="appointmentDateTime" required>
            </div>
            
            <div class="form-group">
                <label for="reason">Reason:</label>
                <textarea id="reason" rows="3" placeholder="Reason for appointment">Test appointment</textarea>
            </div>
            
            <button type="submit">Test Create Appointment</button>
        </form>
        
        <div id="result"></div>
        <div id="debug"></div>
    </div>

    <script>
        // Set default date to tomorrow
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(10, 0, 0, 0);
        document.getElementById('appointmentDateTime').value = tomorrow.toISOString().slice(0, 16);
        
        document.getElementById('appointmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            const debugDiv = document.getElementById('debug');
            
            const formData = {
                doctorId: parseInt(document.getElementById('doctorId').value),
                hospitalId: parseInt(document.getElementById('hospitalId').value),
                serviceCategoryId: parseInt(document.getElementById('serviceCategoryId').value),
                appointmentDateTime: document.getElementById('appointmentDateTime').value + ':00',
                reason: document.getElementById('reason').value
            };
            
            debugDiv.innerHTML = '<h3>Debug Info:</h3><pre>' + JSON.stringify(formData, null, 2) + '</pre>';
            
            try {
                resultDiv.innerHTML = '<p>Testing appointment creation...</p>';
                
                const response = await fetch('http://localhost:8080/api/patients/me/appointments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer test-token' // We'll test without auth first
                    },
                    body: JSON.stringify(formData)
                });
                
                debugDiv.innerHTML += '<h3>Response Status:</h3><pre>' + response.status + ' ' + response.statusText + '</pre>';
                
                const responseText = await response.text();
                debugDiv.innerHTML += '<h3>Response Body:</h3><pre>' + responseText + '</pre>';
                
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="success">✅ Appointment created successfully!</div>';
                } else {
                    resultDiv.innerHTML = '<div class="error">❌ Failed to create appointment. Check debug info above.</div>';
                }
                
            } catch (error) {
                resultDiv.innerHTML = '<div class="error">❌ Network error: ' + error.message + '</div>';
                debugDiv.innerHTML += '<h3>Error:</h3><pre>' + error.stack + '</pre>';
            }
        });
    </script>
</body>
</html>


